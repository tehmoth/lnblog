<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>I don't hate everything: jamesw: May 2010 Archives</title>
    <meta name="generator" content="Movable Type Open Source 4.1" />
    <link rel="stylesheet" href="../../../styles.css" type="text/css" />
    
    
<link rel="alternate" type="application/atom+xml" title="Atom" href="../../../atom.xml" />
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.xml" />
        
<link rel="start" href="../../../../perl" title="Home" />
        
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="http://blogs.loveandnature.co.za/www/perl">
<dc:title>I don&apos;t hate everything</dc:title>
<dc:description>OpenBSD, Perl and PostgreSQL, these are some of my favourite things. Python, Ruby, MySQL, Linux and  &apos;non-relational databases&apos; like CouchDB will not be featured much, except as examples of doing it wrong.</dc:description>
<license rdf:resource="http://creativecommons.org/licenses/by/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by/3.0/">
</License>
</rdf:RDF>
-->

    

        <link rel="prev" href="../../2009/08/index.html" title="jamesw: August 2009" />
        <link rel="next" href="../06/index.html" title="jamesw: June 2010" />
    
</head>
<body class="mt-archive-listing mt-author-monthly-archive layout-tw">
    <div id="container">
        <div id="container-inner">
            <div id="header">
                <div id="header-inner">
                    <div id="header-content">

                        <div id="header-name"><a href="../../../../perl" accesskey="1">I don't hate everything</a></div>
                        <div id="header-description">OpenBSD, Perl and PostgreSQL, these are some of my favourite things. Python, Ruby, MySQL, Linux and  'non-relational databases' like CouchDB will not be featured much, except as examples of doing it wrong.</div>

                    </div>
                </div>
            </div>
            <div id="content">
                <div id="content-inner">
                    <div id="alpha">
                        <div id="alpha-inner">


<h1 id="page-title" class="archive-title">

jamesw: May 2010 Archives

</h1>


    
<!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
         xmlns:dc="http://purl.org/dc/elements/1.1/">
<rdf:Description
    rdf:about="http://blogs.loveandnature.co.za/www/perl/jamesw/2010/05/index.html#000233"
    trackback:ping="http://blogs.loveandnature.co.za/mt/trackback/15"
    dc:title="a less magical with block."
    dc:identifier="http://blogs.loveandnature.co.za/www/perl/jamesw/2010/05/index.html#000233"
    dc:subject=""
    dc:description="For some reason lately there has been interest in re-creating the Javascript with function in Perl (despite the fact that ES5 Strict removes with and with has problems of its own).&amp;nbsp; These seem to be focused on using code-rewriting solutions..."
    dc:creator="jamesw"
    dc:date="2010-05-16T23:34:48-08:00" />
</rdf:RDF>
-->

<div id="entry-233" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="../../../2010/05/a-less-magical-with-block.html">a less magical with block.</a></h2>
        <div class="asset-meta">
    <span class="byline vcard">

        By <address class="vcard author"><a class="fn url" href="http://www.loveandnature.co.za">jamesw</a></address> on <abbr class="published" title="2010-05-16T23:34:48-08:00">May 16, 2010 11:34 PM

    </span>
    <span class="separator">|</span> <a class="permalink" rel="bookmark" href="../../../2010/05/a-less-magical-with-block.html">Permalink</a>
    
        
        
    
</div>

    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            For some reason lately there has been interest in re-creating the Javascript <i>with</i> function in Perl (despite the fact that ES5 Strict removes with and with has problems of its own).&nbsp; These seem to be focused on using code-rewriting solutions (Source filters and Devel::Declare), which use too much magic for too little syntactical gain, why not something like the following:<br /><br />package WithBlock;<br />use strict;<br />use warnings;<br />use Scalar::Util 'blessed';<br />use Exporter qw{import};<br />our @EXPORT = qw{with dowith};<br />sub with($&amp;) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; no strict 'refs';<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; my $pkg = caller(0);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; my ($scope, $sub) = @_;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; my $class = blessed $scope || $scope;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; my @withsubs;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; local *{"${pkg}::AUTOLOAD"} = sub {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; our $AUTOLOAD;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; my ($method) = ($AUTOLOAD =~ m{.+::(.+)$}g);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (my $isub = $scope-&gt;can($method)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; push @withsubs, $AUTOLOAD;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *{$AUTOLOAD} = sub {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; unshift @_, $scope;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; goto &amp;$isub;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; goto &amp;{$AUTOLOAD};<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; die "Undefined subroutine &amp;$AUTOLOAD called"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $sub-&gt;();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach my $sub (@withsubs) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; undef *{$sub};<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />}<br /><br />sub dowith(&amp;$) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; @_[0, 1] = @_[1, 0];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; goto __PACKAGE__-&gt;can('with');<br />}<br /><br />Admittedly you don't get the 'nice' syntax of <i>with ($object) { code block }</i> you have to settle for <i>with $object, sub { code block }</i> or <i>dowith { code block } $object.&nbsp; </i>WithBlock only works for functions of $object that aren't already defined in your current scope.<br /><br /><i><br /></i><br /> 
        </div>



    </div>
    <div class="asset-footer"></div>
</div>

    


<div class="content-nav">
    
    <a href="../../2009/08/index.html">&laquo; jamesw: August 2009</a> |
    
    <a href="../../../../perl">Main Index</a> |
    <a href="../../../archives.html">Archives</a>
    
    | <a href="../06/index.html">jamesw: June 2010 &raquo;</a>
    
</div>

                        </div>
                    </div>

                <div id="beta">
    <div id="beta-inner">

    <div class="widget-search widget">
    <h3 class="widget-header">Search</h3>
    <div class="widget-content">
        <form method="get" action="http://blogs.loveandnature.co.za/mt/search">
            <input type="text" id="search" class="ti" name="search" value="" />

            <input type="hidden" name="IncludeBlogs" value="21" />

            <input type="submit" accesskey="4" value="Search" />
        </form>
    </div>
</div>

<div class="widget-about-this-page widget">
    <h3 class="widget-header">

    
        About this Archive
    


    </h3>
    <div class="widget-content">




    
        <p class="first">This page is a archive of recent entries written by <strong>jamesw</strong> in <strong>May 2010</strong>.</p>
        
        <p><a href="../../2009/08/index.html">jamesw: August 2009</a> is the previous archive.</p>
        
        
        <p><a href="../06/index.html">jamesw: June 2010</a> is the next archive.</p>
        
    



        <p>Find recent content on the <a href="../../../../perl">main index</a> or look in the <a href="../../../archives.html">archives</a> to find all content.</p>

    </div>
</div>





    
<div class="widget-archive widget-archive-category widget">
    <h3 class="widget-header">Categories</h3>
    <div class="widget-content">
    
    </div>
</div>




    
    
        
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="../../../archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul class="widget-list">
        
            <li class="widget-list-item"><a href="../../../2010/06/index.html">June 2010 (1)</a></li>
        
    
        
            <li class="widget-list-item"><a href="../../../2010/05/index.html">May 2010 (1)</a></li>
        
    
        
            <li class="widget-list-item"><a href="../../../2009/08/index.html">August 2009 (1)</a></li>
        
    
        
            <li class="widget-list-item"><a href="../../../2009/07/index.html">July 2009 (1)</a></li>
        
    
        
            <li class="widget-list-item"><a href="../../../2009/06/index.html">June 2009 (1)</a></li>
        
    
        
            <li class="widget-list-item"><a href="../../../2009/05/index.html">May 2009 (3)</a></li>
        
    
        
            <li class="widget-list-item"><a href="../../../2009/04/index.html">April 2009 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    




<div class="widget-pages widget">
    <h3 class="widget-header">Pages</h3>
    <div class="widget-content">
    
    
   </div>
</div>

<script type="text/javascript" src="../../../mt.js"></script>
<div class="widget-sign-in widget">
    <h3 class="widget-header">Sign In</h3>
    <div class="widget-content">
<script type="text/javascript">
<!--
var name, id, url, blog_ids;
if (typeof(commenter_name) != 'undefined')
    name = commenter_name
if (typeof(commenter_id) != 'undefined')
    id = commenter_id;
if (typeof(commenter_url) != 'undefined')
    url = commenter_url;
if (typeof(commenter_blog_ids) != 'undefined')
    blog_ids = commenter_blog_ids;

if (!name && !id) {
    if ('blogs.loveandnature.co.za' != 'blogs.loveandnature.co.za') {
        document.write('<scr' + 'ipt src="http://blogs.loveandnature.co.za/mt/comments?__mode=cmtr_name_js">');
        document.write("</scr" + "ipt>");
    } else {
        name = getCookie('commenter_name');
        ids = getCookie('commenter_id').split(':');
        id = ids[0];
        blog_ids = ids[1];
        url = getCookie('commenter_url');
    }
}
showMessage(name, id, url);

function showMessage(commenter_name, commenter_id, commenter_url) {
    static = location.href;
    if ( commenter_name &&
         ( !commenter_id 
        || commenter_blog_ids.indexOf("'21'") > -1))
    {
        var url;
        if (commenter_id) {
            url = 'http://blogs.loveandnature.co.za/mt/comments?__mode=edit_profile&commenter=' + commenter_id + '&blog_id=21';
            url += '&static=' + static;
        } else if (commenter_url) {
            url = commenter_url;
        } else {
            url = null;
        }
        var content = 'You are signed in as ';
        if (url) {
            content += '<a href="' + url + '">' + commenter_name + '</a>';
        } else {
            content += commenter_name;
        }
        content += '.  (<a href="http://blogs.loveandnature.co.za/mt/comments?__mode=handle_sign_in&amp;logout=1&static=' + static + '">sign out</a>)';
        document.write(content);
    } else if (commenter_name) {
        document.write('You do not have permission to sign in to this blog. (<a href="http://blogs.loveandnature.co.za/mt/comments?__mode=handle_sign_in&amp;logout=1&static=' + static + '">sign out</a>)');
    } else {
    
    }
}
//-->
</script>
    </div>
</div>
<div class="widget-syndication widget">
    <div class="widget-content">
        <ul class="blog-feeds">
            <li class="blog feed"><img src="http://blogs.loveandnature.co.za/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="../../../rss.xml">Subscribe to this blog's feed</a></li>

        </ul>
    </div>
</div>


    </div>
</div>



                </div>
            </div>
            <div id="footer">
                <div id="footer-inner">
                    <div id="footer-content">
                        <div class="widget-powered widget">
                            <div class="widget-content">
                                Powered by <a href="http://www.movabletype.com/">Movable Type Open Source</a>
                            </div>
                        </div>

                        <div class="widget-creative-commons widget">
                            <div class="widget-content">
                                This blog is licensed under a <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons License</a>.
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

